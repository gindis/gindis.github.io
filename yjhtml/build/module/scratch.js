define("module/scratch",[],function(t,e,i){"use strict";function s(t,e,i,s,a,n){this.conId=t,this.conNode=document.getElementById(this.conId),this.cover=e,this.coverType=i,this.background=null,this.backCtx=null,this.mask=null,this.maskCtx=null,this.lottery=null,this.lotteryType="image",this.width=s||300,this.height=a||100,this.cvs=s,this.clientRect=null,this.drawPercentCallback=n}s.prototype={createElement:function(t,e){var i=document.createElement(t);for(var s in e)i.setAttribute(s,e[s]);return i},getTransparentPercent:function(t,e,i){for(var s=t.getImageData(0,0,e,i),a=s.data,n=[],c=0,h=a.length;h>c;c+=4){var o=a[c+3];128>o&&n.push(c)}return(n.length/(a.length/4)*100).toFixed(2)},resizeCanvas:function(t,e,i){t.width=e,t.height=i,t.getContext("2d").clearRect(0,0,e,i)},clear:function(){},drawPoint:function(t,e){this.maskCtx.beginPath();var i=this.maskCtx.createRadialGradient(t,e,0,t,e,30);i.addColorStop(0,"rgba(0,0,0,0.6)"),i.addColorStop(1,"rgba(255, 255, 255, 0)"),this.maskCtx.fillStyle=i,this.maskCtx.arc(t,e,30,0,2*Math.PI,!0),this.maskCtx.fill(),this.drawPercentCallback&&this.drawPercentCallback.call(null,this.getTransparentPercent(this.maskCtx,this.width,this.height))},bindEvent:function(){var t=this,e=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),i=e?"touchstart":"mousedown",s=e?"touchmove":"mousemove";if(e)document.addEventListener("touchmove",function(t){a&&t.preventDefault()},!1),document.addEventListener("touchend",function(t){a=!1},!1);else{var a=!1;document.addEventListener("mouseup",function(t){a=!1},!1)}this.mask.addEventListener(i,function(i){a=!0;var s=document.documentElement;t.clientRect||(t.clientRect={left:0,top:0});var n=(e?i.touches[0].clientX:i.clientX)-t.clientRect.left+s.scrollLeft-s.clientLeft,c=(e?i.touches[0].clientY:i.clientY)-t.clientRect.top+s.scrollTop-s.clientTop;t.drawPoint(n,c)},!1),this.mask.addEventListener(s,function(i){if(!e&&!a)return!1;var s=document.documentElement;t.clientRect||(t.clientRect={left:0,top:0});var n=(e?i.touches[0].clientX:i.clientX)-t.clientRect.left+s.scrollLeft-s.clientLeft,c=(e?i.touches[0].clientY:i.clientY)-t.clientRect.top+s.scrollTop-s.clientTop;t.drawPoint(n,c)},!1)},drawLottery:function(){if(this.background=this.background||this.createElement("canvas",{style:"position:absolute;left:0;top:0;"}),this.mask=this.mask||this.createElement("canvas",{style:"position:absolute;left:0;top:0;"}),this.conNode.innerHTML.replace(/[\w\W]| /g,"")||(this.conNode.appendChild(this.background),this.conNode.appendChild(this.mask),this.clientRect=this.conNode?this.conNode.getBoundingClientRect():null,this.bindEvent()),this.backCtx=this.backCtx||this.background.getContext("2d"),this.maskCtx=this.maskCtx||this.mask.getContext("2d"),"image"==this.lotteryType){var t=new Image,e=this;t.onload=function(){e.width=this.width,e.height=this.height,e.resizeCanvas(e.background,e.cvs,e.cvs),e.backCtx.beginPath(),e.backCtx.arc(e.cvs/2,e.cvs/2,e.cvs/2,0,2*Math.PI,!0),e.backCtx.closePath(),e.backCtx.clip(),e.backCtx.drawImage(this,0,0,e.cvs,e.cvs),e.drawMask()},t.src=this.lottery}else if("text"==this.lotteryType){this.width=this.width,this.height=this.height,this.resizeCanvas(this.background,this.width,this.height),this.backCtx.save(),this.backCtx.fillStyle="#fff",this.backCtx.beginPath(),this.backCtx.arc(this.width/2,this.height/2,this.height/2,0,2*Math.PI,!0),this.backCtx.closePath(),this.backCtx.clip(),this.backCtx.save();var i=30;this.backCtx.font="Bold "+i+"px Arial",this.backCtx.textAlign="center",this.backCtx.fillStyle="#F60",this.backCtx.fillText(this.lottery,this.width/2,this.height/2+i/2),this.backCtx.restore(),this.drawMask()}},drawMask:function(){if(this.resizeCanvas(this.mask,this.cvs,this.cvs),"color"==this.coverType)this.maskCtx.fillStyle=this.cover,this.maskCtx.fillRect(0,0,this.width,this.height),this.maskCtx.globalCompositeOperation="destination-out";else if("image"==this.coverType){var t=new Image,e=this;t.crossOrigin="anonymous",t.onload=function(){e.maskCtx.beginPath(),e.maskCtx.arc(e.cvs/2,e.cvs/2,e.cvs/2,0,2*Math.PI,!0),e.maskCtx.closePath(),e.maskCtx.clip(),e.maskCtx.drawImage(this,0,0,e.cvs,e.cvs),e.maskCtx.globalCompositeOperation="destination-out"},t.src=this.cover}},init:function(t,e){this.lottery=t,this.lotteryType=e||"image",this.drawLottery()}},i.exports=s});