define("category/index",["common/js/util","common/js/jsbridge","module/js/net","module/js/loading","module/js/modal","./views/category-render","./views/item-render","module/js/fastclick"],function(e,t,a){"use strict";function o(){this.init.apply(this,arguments)}var s,i,n,c,d,_,r,l,G,m,O=e("common/js/util"),u=(e("common/js/jsbridge"),e("module/js/net")),L=e("module/js/loading"),A=e("module/js/modal");G=50,m=!1;var h=e("./views/category-render"),N=e("./views/item-render"),p=e("module/js/fastclick");p(document.body),n=new L({content:"加载中..."}),s=new u,i=new Object,i=O.getRequest(!1),c=i.id,d=i.deviceType,_=i.accessToken,l=i.choose,r="click",($.os.android||$.os.ios)&&(r="tap"),"undefined"==typeof _GLOBAL_CONFIG_&&(window._GLOBAL_CONFIG_={}),c&&(_GLOBAL_CONFIG_.id=c),_&&(_GLOBAL_CONFIG_.accessToken=_),_GLOBAL_CONFIG_.PAGE={startRow:0,startTime:null,hasNextPage:!0},o.prototype={init:function(){var e=this;e._loadData(),e._bindEvent()},_loadData:function(e){l=l?Number(l):0,s.ajax("topicDetail",{id:_GLOBAL_CONFIG_.id,choose:l,accessToken:_GLOBAL_CONFIG_.accessToken},function(e){var t,a=$("body");e.choose=l,a.append(h(e)),n.hide(),0==l?t=e.dynamics:1==l&&(t=e.products),_GLOBAL_CONFIG_.PAGE.startTime=t.firstTime,_GLOBAL_CONFIG_.PAGE.hasNextPage=t.hasNextPage,_GLOBAL_CONFIG_.PAGE.startRow+=t.pageSize})},_bindEvent:function(){var e=this;$(".J_fav").live(r,function(t){t.preventDefault();var a=$(this),o={},i="praise";o.id=a.attr("data-id"),a.hasClass("liked")&&(i="cancelPraise"),d?s.ajax(i,o,function(e){a.hasClass("liked")?(a.removeClass("liked"),a.html(Number(a.text())-1)):(a.addClass("liked"),a.html(Number(a.text())+1))}):e.tipsReg()}),$(window).scroll(function(){var e=$(window).scrollTop(),t=parseFloat($(window).height())+parseFloat(e),a=$(document).height();!m&&t>=a-G&&_GLOBAL_CONFIG_.PAGE.hasNextPage&&(m=!0,s.ajax("topicDetail",{id:_GLOBAL_CONFIG_.id,choose:l,accessToken:_GLOBAL_CONFIG_.accessToken,startRow:_GLOBAL_CONFIG_.PAGE.startRow,startTime:_GLOBAL_CONFIG_.PAGE.startTime},function(e){e.choose=l;var t,a=N(e);$("#columns").append(a),0==l?t=e.dynamics:1==l&&(t=e.products),_GLOBAL_CONFIG_.PAGE.startTime=t.firstTime,_GLOBAL_CONFIG_.PAGE.hasNextPage=t.hasNextPage,_GLOBAL_CONFIG_.PAGE.startRow+=t.pageSize,m=!1}))})},tipsReg:function(){new A({content:"需要注册才能执行该操作",button:[{title:"取消"},{title:"注册"}],callback:function(e,t){1==t&&(location.href="./reg.html")}})}},a.exports=o});