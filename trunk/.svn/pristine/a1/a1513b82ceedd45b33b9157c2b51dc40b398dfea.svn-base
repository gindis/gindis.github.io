define("topic/index",["common/js/util","common/js/jsbridge","module/js/net","module/js/loading","module/js/modal","./views/topicdetail-render","./views/item-render","module/js/fastclick"],function(t,e,a){"use strict";function i(){this.init.apply(this,arguments)}var s,n,o,d,c,l,r,m,p,u=t("common/js/util"),f=t("common/js/jsbridge"),v=t("module/js/net"),h=t("module/js/loading"),b=t("module/js/modal"),_=t("./views/topicdetail-render"),w=t("./views/item-render"),j=t("module/js/fastclick");j(document.body),o=new h({content:"加载中..."}),s=new v,n=new Object,n=u.getRequest(!1),d=n.id,c=n.deviceType,l=n.accessToken,r="click",($.os.android||$.os.ios)&&(r="tap"),"undefined"==typeof _GLOBAL_CONFIG_&&(window._GLOBAL_CONFIG_={}),d&&(_GLOBAL_CONFIG_.id=d),i.prototype={init:function(){var t=this;t._loadData(),t._bindEvent()},_loadData:function(t){var e=this;e.getTopicDetail()},getTopicDetail:function(){var t=this;s.ajax("topicDetail",{id:_GLOBAL_CONFIG_.id,accessToken:l},function(e){var a=$("body");c&&(e.deviceType=c),l&&(e.accessToken=l),e.randomstr=+new Date,a.append(_(e,{commands:{encodeURI:function(t,e){var a;return a=e.params[0],encodeURIComponent(a)}}})),$(".follow").on(r,function(){var e=$(this),a=e.attr("data-type"),i=e.attr("data-id"),n={};if(l){var o="";"topic"===a?(o="addFollow",e.hasClass("isFollow")&&(o="delFollow"),n.type=1):"user"===a&&(o="addAttention",n.byUserId=i),n.businessId=i,n.accessToken=l,s.ajax(o,n,function(t){var i="";"topic"===a?e.hasClass("isFollow")?(i="取消关注成功",e.removeClass("isFollow"),e.html("关注")):(i="关注成功",e.addClass("isFollow"),e.html("已关注")):(i=t.MESSAGE,new b({content:i,button:[{title:"确认"}],callback:function(t,e){}}))})}else t.tipsReg()}),$(".J_actBtn").on(r,function(e){c||t.tipsReg()});var i=$(".J_more");m=i.attr("data-pagesize"),p=i.attr("data-firsttime"),i.on(r,function(t){var e,a=$(this),i=a.attr("data-type"),n=a.attr("data-startid"),o={},d="topicDynamicList";a.hasClass("disabled")||(a.html('<span class="btn-more">加载中...</span>'),a.addClass("disabled"),"dynamic"==i?(d="topicDynamicList",e=".matchs-inner"):"product"==i?(d="topicProductList",e=".post"):"counsel"==i&&(d="topicDynamicList",e=".mcounsel"),o.id=_GLOBAL_CONFIG_.id,o.startRow=Number(m),o.startId=Number(n),p&&""!=p&&(o.firstTime=p),s.ajax(d,o,function(t){t.type=i;var s=w(t);$(e).append(s),t.pageSize&&(m=o.startRow+t.pageSize),t.firstTime&&(p=t.firstTime),t.hasNextPage?(a.removeClass("disabled"),a.html('<span class="btn-more">加载更多</span>')):a.html('<span class="btn-more disabled">没有更多</span>')}))}),o.hide()})},tipsReg:function(){new b({content:"需要注册才能执行该操作",button:[{title:"取消"},{title:"注册"}],callback:function(t,e){1==e&&(location.href="./reg.html")}})},_bindEvent:function(){var t=this;c&&$(".link").live("click",function(t){t.preventDefault();var e,a,i=$(this);e=i.attr("data-type"),a=i.attr("data-id"),"user"==e?f.user(a):"product"==e?f.product({id:a}):"dynamic"==e&&f.dynamic({id:a})}),$(".J_fav").live(r,function(e){e.preventDefault();var a=$(this),i={},n="praise";i.id=a.attr("data-id"),a.hasClass("faved")&&(n="cancelPraise"),c?s.ajax(n,i,function(t){a.hasClass("faved")?(a.removeClass("faved"),a.html(Number(a.text())-1)):(a.addClass("faved"),a.html(Number(a.text())+1))}):t.tipsReg()})}},a.exports=i});