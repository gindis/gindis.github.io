define("magazine/index",["common/js/util","common/js/jsbridge","module/js/net","module/js/loading","module/js/modal","./views/magazine-render","./views/item-render","module/js/fastclick"],function(e,a,t){"use strict";function i(){this.init.apply(this,arguments)}var n,s,o,_,d,c,r,G,m,O=e("common/js/util"),L=e("common/js/jsbridge"),l=e("module/js/net"),u=e("module/js/loading");e("module/js/modal");G=50,m=!1;var A=e("./views/magazine-render"),g=e("./views/item-render"),N=e("module/js/fastclick");N(document.body),o=new u({content:"加载中..."}),n=new l,s=new Object,s=O.getRequest(!1),_=s.id,d=s.deviceType,c=s.accessToken,r="click",($.os.android||$.os.ios)&&(r="tap"),"undefined"==typeof _GLOBAL_CONFIG_&&(window._GLOBAL_CONFIG_={}),_&&(_GLOBAL_CONFIG_.id=_),c&&(_GLOBAL_CONFIG_.accessToken=c),_GLOBAL_CONFIG_.PAGE={startRow:0,startTime:null,hasNextPage:!0},i.prototype={init:function(){var e=this;e._loadData(),e._bindEvent()},_loadData:function(e){n.ajax("magazineDetail",{magazineId:_GLOBAL_CONFIG_.id,accessToken:_GLOBAL_CONFIG_.accessToken},function(e){var a=$("body");a.append(A(e)),o.hide();var t=e.magazineItems;_GLOBAL_CONFIG_.PAGE.startTime=t.firstTime,_GLOBAL_CONFIG_.PAGE.hasNextPage=t.hasNextPage,_GLOBAL_CONFIG_.PAGE.startRow=t.pageSize})},_bindEvent:function(){d&&$(".link").live("click",function(e){e.preventDefault();var a,t,i=$(this);a=i.attr("data-type"),t=i.attr("data-id"),"user"==a?L.user(t):"product"==a?L.product({id:t}):"dynamic"==a&&L.dynamic({id:t})}),$(window).scroll(function(){var e=$(window).scrollTop(),a=parseFloat($(window).height())+parseFloat(e),t=$(document).height();!m&&a>=t-G&&_GLOBAL_CONFIG_.PAGE.hasNextPage&&(m=!0,n.ajax("magazineDetail",{magazineId:_GLOBAL_CONFIG_.id,accessToken:_GLOBAL_CONFIG_.accessToken,startRow:_GLOBAL_CONFIG_.PAGE.startRow,startTime:_GLOBAL_CONFIG_.PAGE.startTime},function(e){var a=g(e);$("#columns").append(a);var t=e.magazineItems;_GLOBAL_CONFIG_.PAGE.startTime=t.firstTime,_GLOBAL_CONFIG_.PAGE.hasNextPage=t.hasNextPage,_GLOBAL_CONFIG_.PAGE.startRow+=t.pageSize,m=!1}))})}},t.exports=i});